@page "/example/settings/profile"
@namespace Deneblab.BlazorDaisy.Areas.Example.Views.Pages.Settings
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@attribute [Authorize]

<PageTitle>Profile Settings</PageTitle>

<PageHeader
    Title="Profile Settings"
    Subtitle="Your personal information and account details" />

<div class="card bg-base-200">
    <div class="card-body">
        <h2 class="card-title">Personal Information</h2>

        <div class="form-control w-full max-w-xs">
            <label class="label">
                <span class="label-text">Display name</span>
            </label>
            <input type="text" placeholder="@UserName" class="input input-bordered w-full max-w-xs" />
        </div>

        <div class="form-control w-full max-w-xs">
            <label class="label">
                <span class="label-text">Email</span>
            </label>
            <input type="email" placeholder="@UserEmail" class="input input-bordered w-full max-w-xs" disabled />
        </div>

        <div class="form-control w-full max-w-xs">
            <label class="label">
                <span class="label-text">Bio</span>
            </label>
            <textarea class="textarea textarea-bordered" placeholder="Tell us about yourself"></textarea>
        </div>

        <div class="card-actions justify-end mt-4">
            <button class="btn btn-primary">Save Changes</button>
        </div>
    </div>
</div>

@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthStateTask { get; set; }

    private string UserName { get; set; } = "User";
    private string UserEmail { get; set; } = "user@example.com";

    protected override async Task OnInitializedAsync()
    {
        if (AuthStateTask != null)
        {
            var authState = await AuthStateTask;
            var user = authState.User;

            UserName = user.FindFirst(ClaimTypes.Name)?.Value
                ?? user.FindFirst("name")?.Value
                ?? user.Identity?.Name
                ?? "User";

            UserEmail = user.FindFirst(ClaimTypes.Email)?.Value
                ?? user.FindFirst("email")?.Value
                ?? "user@example.com";
        }
    }
}
