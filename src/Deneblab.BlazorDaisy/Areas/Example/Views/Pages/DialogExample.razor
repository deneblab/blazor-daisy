@page "/example/dialog"
@namespace Deneblab.BlazorDaisy.Areas.Example.Views.Pages
@rendermode InteractiveServer
@using Deneblab.BlazorDaisy.Components.Layout
@using Deneblab.BlazorDaisy.Components.Dialog
@using Deneblab.BlazorDaisy.Areas.Example.Views.Dialogs
@inject IDialogService Dialog

<PageTitle>Dialog Examples</PageTitle>

<PageHeader
    Title="Dialog Examples"
    Subtitle="Interactive examples demonstrating the Dialog system" />

<div class="space-y-6">
    <!-- Basic Usage -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Basic Dialog</h2>
            <p class="text-base-content/70">A simple dialog with a message and OK button.</p>
            <div class="flex flex-wrap gap-2 mt-4">
                <button class="btn btn-primary" @onclick="ShowSimpleDialog">
                    Open Simple Dialog
                </button>
            </div>
            @if (!string.IsNullOrEmpty(_simpleResult))
            {
                <div class="alert alert-info mt-4">
                    <span>Result: @_simpleResult</span>
                </div>
            }
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Confirmation Dialog</h2>
            <p class="text-base-content/70">A dialog that asks for user confirmation.</p>
            <div class="flex flex-wrap gap-2 mt-4">
                <button class="btn btn-warning" @onclick="ShowConfirmDialog">
                    Delete Item
                </button>
            </div>
            @if (!string.IsNullOrEmpty(_confirmResult))
            {
                <div class="alert @(_confirmed ? "alert-success" : "alert-error") mt-4">
                    <span>@_confirmResult</span>
                </div>
            }
        </div>
    </div>

    <!-- Form Dialog -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Form Dialog</h2>
            <p class="text-base-content/70">A dialog with form inputs that returns data.</p>
            <div class="flex flex-wrap gap-2 mt-4">
                <button class="btn btn-accent" @onclick="ShowFormDialog">
                    Open Form Dialog
                </button>
            </div>
            @if (_formData != null)
            {
                <div class="alert alert-success mt-4">
                    <span>Submitted: @_formData.Name (@_formData.Email)</span>
                </div>
            }
        </div>
    </div>

    <!-- Dialog Options -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Dialog Options</h2>
            <p class="text-base-content/70">Dialogs with different configurations.</p>
            <div class="flex flex-wrap gap-2 mt-4">
                <button class="btn btn-outline btn-sm" @onclick="ShowNoCloseButtonDialog">
                    No Close Button
                </button>
                <button class="btn btn-outline btn-sm" @onclick="ShowNoBackdropCloseDialog">
                    No Backdrop Close
                </button>
                <button class="btn btn-outline btn-sm" @onclick="ShowWideDialog">
                    Wide Dialog (lg)
                </button>
                <button class="btn btn-outline btn-sm" @onclick="ShowTopDialog">
                    Top Position
                </button>
            </div>
        </div>
    </div>

    <!-- Code Example -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Code Example</h2>
            <p class="text-base-content/70">How to use the Dialog service in your components.</p>
            <div class="mockup-code mt-4">
                <pre data-prefix="1"><code>@@inject IDialogService Dialog</code></pre>
                <pre data-prefix="2"><code></code></pre>
                <pre data-prefix="3" class="text-success"><code>// Simple dialog</code></pre>
                <pre data-prefix="4"><code>var result = await Dialog.ShowAsync&lt;SimpleDialog&gt;("Title");</code></pre>
                <pre data-prefix="5"><code></code></pre>
                <pre data-prefix="6" class="text-success"><code>// With parameters</code></pre>
                <pre data-prefix="7"><code>var parameters = new DialogParameters&lt;ConfirmDialog&gt;</code></pre>
                <pre data-prefix="8"><code>{{ "{{ x => x.Message, \"Delete this?\" }}" }};</code></pre>
                <pre data-prefix="9"><code>var result = await Dialog.ShowAsync&lt;ConfirmDialog&gt;("Confirm", parameters);</code></pre>
                <pre data-prefix="10"><code></code></pre>
                <pre data-prefix="11" class="text-success"><code>// Check result</code></pre>
                <pre data-prefix="12"><code>if (!result.Canceled) {{ "{ /* user confirmed */ }" }}</code></pre>
            </div>
        </div>
    </div>

    <!-- Back Navigation -->
    <div class="flex justify-end">
        <a href="/example" class="btn btn-ghost">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Back to Examples
        </a>
    </div>
</div>

@code {
    private string _simpleResult = "";
    private string _confirmResult = "";
    private bool _confirmed;
    private FormDialog.FormData? _formData;

    private async Task ShowSimpleDialog()
    {
        var parameters = new DialogParameters<SimpleDialog>
        {
            { x => x.Message, "Hello! This is a simple dialog message." }
        };
        var result = await Dialog.ShowAsync<SimpleDialog>("Simple Dialog", parameters);
        _simpleResult = result.Canceled ? "Dialog was closed" : "OK clicked";
    }

    private async Task ShowConfirmDialog()
    {
        var parameters = new DialogParameters<ConfirmDialog>
        {
            { x => x.Message, "Are you sure you want to delete this item? This action cannot be undone." },
            { x => x.ConfirmText, "Delete" },
            { x => x.CancelText, "Keep" }
        };
        var result = await Dialog.ShowAsync<ConfirmDialog>("Confirm Delete", parameters);
        _confirmed = !result.Canceled && result.GetData<bool>();
        _confirmResult = _confirmed ? "Item deleted!" : "Deletion cancelled";
    }

    private async Task ShowFormDialog()
    {
        var result = await Dialog.ShowAsync<FormDialog>("Enter Your Details");
        if (!result.Canceled)
        {
            _formData = result.GetData<FormDialog.FormData>();
        }
    }

    private async Task ShowNoCloseButtonDialog()
    {
        var options = new DialogOptions { ShowCloseButton = false };
        await Dialog.ShowAsync<SimpleDialog>("No Close Button", null, options);
    }

    private async Task ShowNoBackdropCloseDialog()
    {
        var options = new DialogOptions { CloseOnBackdropClick = false };
        var parameters = new DialogParameters<SimpleDialog>
        {
            { x => x.Message, "Click outside won't close this dialog. Use the OK button or press Escape." }
        };
        await Dialog.ShowAsync<SimpleDialog>("Modal Dialog", parameters, options);
    }

    private async Task ShowWideDialog()
    {
        var options = new DialogOptions { MaxWidth = "lg" };
        var parameters = new DialogParameters<SimpleDialog>
        {
            { x => x.Message, "This dialog has a wider max-width setting (lg)." }
        };
        await Dialog.ShowAsync<SimpleDialog>("Wide Dialog", parameters, options);
    }

    private async Task ShowTopDialog()
    {
        var options = new DialogOptions { Position = DialogPosition.Top };
        var parameters = new DialogParameters<SimpleDialog>
        {
            { x => x.Message, "This dialog appears at the top of the screen." }
        };
        await Dialog.ShowAsync<SimpleDialog>("Top Position", parameters, options);
    }
}
